# 3. 다른 개발자와 코드 계약

# 3.4 체크 및 어서션

런타임 검사는 컴파일 타임 확인만큼 강력하진 않다.

`코드 계약` 위반이 런타임에 발생하는 문제에 대한 검사나 사용자에 의존하기 때문이다.

> 자주 사용하는 `validateX()` 처럼
실행 중에 잘못된 상황을 검사하는 경우나, 사용자와의 상호작용으로 나타나는 문제들을 얘기해요.
> 

처음부터 `코드 계약` 위반을 논리적으로 막는 컴파일 타임 확인과는 대조적이다.

그 외에도 컴파일러로 계약을 강제할 수 없는 상황이 있는데, 아예 검사하지 않는 것보다 런타임 검사라도 하는 것이 낫다.

# 3.4.1 체크

## 목적

`코드 계약` 조건을 확인하기 위해 사용

- 입력 매개 변수에 대한 제약 조건
- 수행해야 할 설정에 대한 제약

등을 확인하기 위한 로직.

`체크`는 `실패` 를 유발하는 오류를 생성해 놓치고 넘어가지 못하게 한다.

> 앞서 말한 `validateX()`를 생각하면 좋을 것 같습니다.
> 

> 체크가 `failing fast` 와 관련있다고 얘기하는데, 다음 장에서 얘기한다고 합니다 :)
> 

## 전기 스쿠터 예시

- 스쿠터 펌웨어에 안전장치를 추가한다.
- 운전자가 시속 30마일로 달리면 스쿠터가 완전 정지되고, 다시 사용하기 위해서는 재부팅이 필요하다.
- 운전 중에 위험할 수도 있지만, 모터를 손상시키고 과속 딱지를 끊는 것보다는 안전 장치가 작동하는 편이 나을 수 있다.
- 또, 이것보다는 속도 제한 장치를 사용하는 것이 나쁜 상황을 막으므로 최상의 방법이다.

> 이런 문제는 빨리 발견할 수 있으므로 빨리 조치할 수 있다는 얘기인 것 같네요.
`체크` 가 있는 편이 확인하기 어려운 것보다 더 낫다는 이야기 입니다.
책이 구글 번역기 돌린 것처럼 이해하기 좀 어렵게 쓰여있습니다..
> 

## 분류

### 전제 조건 검사

EX) 인수가 올바른지, 초기화가 수행되었는지, 코드 실행 전 시스템이 유효한 상태인지 확인한다.

### 사후 상태 검사

EX) 반환 값이 올바른지, 코드 실행 후 시스템이 유효한 상태인지 확인한다.

## `UserSettings` 예시

앞선 장에서 `UserSettings` 클래스가 잘못 설정되는 것을 처음부터 막아 오류를 줄일 수 있었다.

또 다른 방법은 **전제 조건 검사**를 사용하는 것이다.

![https://user-images.githubusercontent.com/39221443/222220393-dc0277c2-8614-4dd2-852c-a0052cfb0e21.png](https://user-images.githubusercontent.com/39221443/222220393-dc0277c2-8614-4dd2-852c-a0052cfb0e21.png)

버그가 아무도 모르게 발생하는 것을 방지한다.

그러나, 오용을 아예 불가능하게 만든것보다는 이상적이지 않다.

> 컴파일 단계에서 막은 것보다는 이상적이지 않다는 뜻이라고 생각합니다.
> 

## `체크` 의 효과

고객에게 배포되거나 실제 프로덕션에서 서비스되기 전에 개발 단계나 테스트 단계에서 발견되고, 수정될 수 있다.

- 알아차리지 못한 채로 유효하지 못한 상태로 들어가 이상한 버그가 발견되는 것보다는 낫다.

그러나, `체크`의 효과가 항상 보장되지는 않는다.

> 즉, 예외에 걸리지 않는 상황이 있을 수 있다는 뜻인 것 같습니다.
> 
- 테스트하기 불분명한 상황에서만 조건이 위반된다면, 코드가 배포되고 사용자가 쓰기 전까지 버그가 노출되지 않을 수 있다.
- 체크가 잘 작동해도 알지 못할 위험이 있다.
    - 시스템이 아예 멈추는 것을 막기 위해 ‘로깅’을 해두었는데, 개발자들이 잘 확인하지 않는 경우
    - 이 경우는 팀의 실행 지침이나, 예외 처리 지침에 문제가 있다.
    - 꽤 자주 있는 경우이다.

## 결론

경우에 따라 `코드 계약` 에서 세부 조항을 피할 수 없으면, 계약이 준수되는지 확인하기 위해 체크를 추가하는 편이 좋다.

하지만 가능하다면 세부 조항 자체를 피하는 것이 바람직하다.

코드에 체크가 많다면 세부 조항을 없애는 것을 고려해봐야 한다는 신호일지 모른다.